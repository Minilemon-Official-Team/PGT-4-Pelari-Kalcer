Enum user_role {
  member
  photographer
  admin
}

Enum photographer_request_status {
  pending
  approved
  rejected
}

Enum event_visibility {
  public
  private
  unlisted [note: 'Visible via direct link only']
}

Enum event_status {
  draft
  scheduled
  active
  archived
}

Enum photo_status {
  uploaded
  processing
  ready
  failed
  deleting
  deleted
}

Enum match_status {
  pending
  approved
  rejected
  ignored
}

Enum claim_status {
  pending
  approved
  rejected
  cancelled
  expired
}

Table users {
  id uuid [pk, default: `gen_random_uuid()`]
  email varchar(255) [not null, unique]
  password_hash text [not null]
  password_algo varchar(32) [not null, default: 'argon2id']
  username varchar(120) [not null]
  role user_role [not null, default: 'member']
  phone varchar(32)
  last_login_at timestamptz
  photographer_since timestamptz
  created_at timestamptz [not null, default: `now()`]
  updated_at timestamptz [not null, default: `now()`]
}

Table photographer_requests {
  id uuid [pk, default: `gen_random_uuid()`]
  user_id uuid [not null]
  status photographer_request_status [not null, default: 'pending']
  motivation text
  portfolio_url text
  reviewed_by uuid
  reviewed_at timestamptz
  created_at timestamptz [not null, default: `now()`]
}

Table events {
  id uuid [pk, default: `gen_random_uuid()`]
  owner_id uuid [not null]
  name varchar(160) [not null]
  description text
  location text
  starts_at timestamptz
  ends_at timestamptz
  visibility event_visibility [not null, default: 'public']
  status event_status [not null, default: 'draft']
  created_at timestamptz [not null, default: `now()`]
  updated_at timestamptz [not null, default: `now()`]
}

Table photos {
  id uuid [pk, default: `gen_random_uuid()`]
  event_id uuid [not null]
  uploader_id uuid [not null]
  object_key text [not null]
  storage_bucket varchar(64) [not null, default: 'photos']
  mime_type varchar(128)
  width int
  height int
  faces_count int [not null, default: 0]
  status photo_status [not null, default: 'uploaded']
  processed_at timestamptz
  delete_after timestamptz [not null]
  created_at timestamptz [not null, default: `now()`]
  updated_at timestamptz [not null, default: `now()`]
}

Table photo_embeddings {
  id uuid [pk, default: `gen_random_uuid()`]
  photo_id uuid [not null]
  face_index int [not null]
  embedding vector(1536) [not null, note: 'pgvector column']
  model_version varchar(64) [not null]
  confidence numeric(5,4)
  created_at timestamptz [not null, default: `now()`]

  Indexes {
    (photo_id, face_index, model_version) [unique]
  }

}

Table user_embeddings {
  id uuid [pk, default: `gen_random_uuid()`]
  user_id uuid [not null]
  is_active boolean [not null, default: false]
  embedding vector(1536) [not null, note: 'pgvector column']
  model_version varchar(64) [not null]
  created_at timestamptz [not null, default: `now()`]
  updated_at timestamptz [not null, default: `now()`]

  Indexes {
    (user_id, is_active)
  }

}

Table matches {
  id uuid [pk, default: `gen_random_uuid()`]
  user_embedding_id uuid [not null]
  photo_embedding_id uuid [not null]
  score double [not null]
  status match_status [not null, default: 'pending']
  created_at timestamptz [not null, default: `now()`]
  reviewed_at timestamptz

  Indexes {
    (user_embedding_id, photo_embedding_id) [unique]
  }

}

Table claims {
  id uuid [pk, default: `gen_random_uuid()`]
  match_id uuid [not null]
  claimant_id uuid [not null]
  event_id uuid [not null]
  status claim_status [not null, default: 'pending']
  contact_sent_at timestamptz
  message text
  created_at timestamptz [not null, default: `now()`]
  updated_at timestamptz [not null, default: `now()`]
}

Ref: photographer_requests.user_id > users.id
Ref: photographer_requests.reviewed_by > users.id
Ref: events.owner_id > users.id
Ref: photos.event_id > events.id
Ref: photos.uploader_id > users.id
Ref: photo_embeddings.photo_id > photos.id
Ref: user_embeddings.user_id > users.id
Ref: matches.user_embedding_id > user_embeddings.id
Ref: matches.photo_embedding_id > photo_embeddings.id
Ref: claims.match_id > matches.id
Ref: claims.claimant_id > users.id
Ref: claims.event_id > events.id
